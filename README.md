# 城市 POI 数据与图像收集
本项目通过高德、腾讯等地图开放平台获取城市 POI 数据与平面图像，并将收集到的各个 POI 及其周边业态数据进行聚类分析。对于城市设计项目，可以找到与待设计区域相似的已建成区域以供设计参考，通过 pix2pix 工具训练出特定类型区域的路网-建筑模型，进而生成待设计区域的理想建筑形态。也可只使用部分功能，用于城市设计领域的其余用途。

![获取图片示意](/文档图片/标题图.png)

# 1. 获取指定类型 POI 基本信息
首先需要注册成为高德开放平台开发者，并申请用于 Web 服务的 key，详细方法见[创建应用和 Key-Web服务 API | 高德地图API](https://lbs.amap.com/api/webservice/create-project-and-key)	。在后续城市图像收集功能中，推荐使用腾讯位置服务提供的个性化地图编辑功能，其开发者注册与 key 申请方法见[常见问题 | 腾讯位置服务](https://lbs.qq.com/faq/accountQuota/faqKey)。

![获取图片示意](/文档图片/开放平台.png)


通过附带的 POI 分类编码表与城市编码表找到需要查询的城市与 POI 对应编码，将其与 key 一起填入脚本文件，运行 **1 取得poi基础数据** 即可获取对应地区与类型的 POI 基本信息并生成 excel 表格。


# 2. 获取 POI 周边业态信息
运行 **2 取得poi周边信息** 即可读取生成的 POI 基本信息数据，通过高德地图提供的周边搜索服务，以收集到的指定 POI 为圆心，搜索一定半径内的其余 POI ，统计周边餐饮、购物、企业、住宅等各个类别 POI 数量，进而推算指定 POI 周边各业态所占权重，为聚类分析提供数据参考，统计数据将会以原表格为基础，作为添加列导出为新表格。在进行此步骤时，需要消耗的平台服务流量数量较多，请对流量用量保持关注。

![获取图片示意](/文档图片/图表.png)

# 3. 城市 POI 聚类分析
完成 POI 数据收集后，运行 **3 城市数据聚类分析** 以对各个 POI 数据进行 K-Means 聚类分析，进而找出最近似与具有参考价值的 POI 。聚类结果同样将保存至 excel 表格中。

![获取图片示意](/文档图片/图表2.png)

# 4. 获取风格化城市平面
高德、百度、腾讯地图开放平台均提供了自定义地图样式服务，本项目选用样式调整自由度较高的腾讯位置服务。在运行程序前，需要选择一个样式模板或创建自定义样式。

![获取图片示意](/文档图片/自定义样式.png)

完成自定义样式调整后，使用 **鼠标坐标捕获工具** 确认 **4 取得城市平面图片** 程序中各个屏幕坐标位置是否准确。准备完成后，将自定义地图网页置于程序运行环境窗口下，运行 **4 取得城市平面图片** ，程序将会自动输入经纬度信息并截取屏幕图片，按聚类结果保存在不同文件夹中，期间尽量避免鼠标与键盘操作。在所有图片截取并保存完成后，程序将最小化地图网页。

![获取图片示意](/文档图片/样式示意.png)

在此城市设计项目中需要训练模型学习路网-建筑的对应关系，因此需要运行两次此程序，分别获取无建筑的城市路网平面与包含建筑的城市平面，由更改自定义地图选项完成。在多次运行程序时，也需要更改 **4 取得城市平面图片** 程序中的图片名后缀参数。

# 5. pix2pix 前置图片处理
pix2pix模型需要将图片裁剪为固定尺寸，并将对应的两张图片拼合为一张，运行 **5 城市平面图片处理** 程序以完成上述过程，将处理后图片保存在目标文件夹中，以供pix2pix模型训练。pix2pix模型训练过程与项目文件详见：
[junyanz/pytorch-CycleGAN-and-pix2pix: Image-to-Image Translation in PyTorch](https://github.com/junyanz/pytorch-CycleGAN-and-pix2pix)

![获取图片示意](/文档图片/图片拼合.png)


 






